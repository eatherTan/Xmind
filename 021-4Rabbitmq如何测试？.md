# Rabbitmq 如何测试

### RabbitMQ的概念

- Broker：简单来说就是消息队列服务器实体。
- Exchange：消息交换机，它指定消息按什么规则，路由到哪个队列。
- Queue：消息队列载体，每个消息都会被投入到一个或多个队列。
- Binding：绑定，它的作用就是把exchange和queue按照路由规则绑定起来，Exchange 和Queue的绑定可以是多对多的关系。
- Routing Key：路由关键字，exchange根据这个关键字进行消息投递。
- vhost：虚拟主机，一个broker里可以开设多个vhost，用作不同用户的权限分离。
- Producer：消息生产者，就是投递消息的程序。
- Consumer：消息消费者，就是接受消息的程序。
- Channel：消息通道，在客户端的每个连接里，可建立多个channel，每个channel代表一个会话任务。
  	流程
  		

### RabbitMQ消息生产与消费

- ConnectionFactory: 获取连接工厂

- Connection: 一个连接

- Channel: 数据通信信道, 可发送和接收消息

- Queue: 具体的消息存储队列

- Producer & Consumer 生产者和消费者

  

# 「MQ 带来的问题」

- 如何保证消息队列的高可用？
- 如何保证消息不被重复消费？
- 如何处理消息丢失的问题？
- 如何保证消息的顺序性？
- 如何处理消息队列大量消息积压？

上面这些问题，都是实际工作上会遇到的，往往也都是测试点，下面也会有提及到，简单了解下即可。

## 「MQ 产品的对比」

| 产品     | 单机吞吐量 | 时效性 | 可用性   | 消息可靠性           | 功能支持    |
| -------- | ---------- | ------ | -------- | -------------------- | ----------- |
| ActiveMQ | 万级       | 毫秒级 | 高       | 较低概率出现丢失数据 | 极其完备    |
| RabbitMQ | 万级       | 微妙级 | 高       | 基本不丢             | erlang 开发 |
| RocketMQ | 十万级     | 毫秒级 | 非常高   | 可配置 0 丢失        | 分布式      |
| Kafka    | 十万级     | 毫秒级 | 非常高高 | 可配置 0 丢失        | 分布式      |

而在选择上，一般公司都是用`Kafka`跟`RocketMQ`较多。

## 「MQ 的测试点」

### » 生产者

- 生成的数据格式是否跟定义的一致
- 数据是否有成功推送到队列里
- 数据是否有成功推动到对应的 topic
- 推送失败时如何处理
- 重复推送同一条数据，如何处理
- 不同顺序推送消息，注意队列优先级
- 推消息耗时
- 队列容量达到上限，无法推送后如何处理

### » 消费者

- 消费的消息是否来自订阅的 topic
- 消息被消费了，是否有清除
- 生产者推送过快，消费速度过慢（堵塞），会如何
- 无法消费没订阅的 topic 消息
- 生产者推送消息后，消费者接受到的消息内容跟生产者推的一致
- 如何处理重复消息，比如幂等
- 处理超时
- 消息处理失败
- 消费消息的优先级是否跟推的一致
- 消费消息耗时
- 消费者宕机，消息堆积，无人处理，会如何处理
- 是否能正常消费消息

### » 队列

- 宕机恢复后，消息是否丢失
- 宕机预案，多久能恢复，如果无法恢复的预案
- 不同的消息格式，是否能正常识别及转发