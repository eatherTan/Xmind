## 对 RPC 的理解

> 1. 参考 【[RPC理解](https://segmentfault.com/a/1190000020718552)】：https://segmentfault.com/a/1190000020718552

## 1. 什么是RPC

**RPC [Remote Procedure Call]，中文翻译就是 [远程过程调用]，"过程" 也叫方法或函数,"远程" 就是要调用的方法不在不在当前进程中，而是在其他进程或机器上面，合起来RCP 就是调用其他进程或机器上面的方法。**

#### 通过网络通信技术调用不同的服务，共同支撑一个软件系统。
好像这一句话可以概括上面的内容，但是没有那么详细，还是需要仔细理解一下。

## 2. RPC 的分类
RPC主要是解决通讯的问题，主流的RPC框架分为基于HTTP和基于TCP 的两种。 [注意此处的HTTP协议调用和基于HTTP协议的RPC调用是不同的]   

#### RPC调用和HTTP调用的区别
查看五层网络模型的定义
1. 应用层：应用层提供各种应用层协议，这些协议嵌入在我们使用的应用程序中，为用户和网络提供一个打交道的接口
2. 传输层：为不同应用进程之间提供端到端的通信服务
3. 网络层：为交换网上不同分组的主机提供通信服务
4. 数据链路层：在物理层提供的服务基础之上向网络层提供服务，主要有将数据封装成帧，透明传输，差错监测
5. 物理层：消除硬件的差异，为传授数据提供可靠的通路和环境
> 因为HTTP是应用协议，而TCP是传输层协议。HTTP是基于应用层的，RPC是基于传输层的。

#### 2.1区别
- RPC：可以基于TCP协议，也可以基于HTTP协议。
- HTTP：基于HTTP协议

#### 2.2 传输效率
- RPC：使用自定的TCP协议，可以让请求报文的体积更小，提高传输效率。
- HTTP: 基于HTTP1.1的协议，请求中会包含很多无用信息。如果基于HTTP2.0，那么可以简单的封装一下，作为RPC使用。
#### 2.3 性能消耗
- RPC：基于thrift实现高效的二进制传输。
- HTTP：大部分通过Json字符串实现，字节大小和序列化的耗时都比thrift更加消耗性能。
#### 2.4 负载均衡
- RPC：基本都自带了负载均衡策略。
- HTTP：需要Nginx，HAProxy来实现。（要使用代理去访问）
#### 2.5 服务治理
- RPC： 能做到自动通知，不影响上游。（参考资料：Zookeeper的服务治理）

HTTP： 需要事先通知，修改Nginx/HAProxy。（负载均衡不考虑已下线服务器，或者增加上线服务器）

RPC首要解决的是通讯的问题，主流的RPc框架分为基于HTTP和基于TcP的两种。基于HTTP的RPc调用很简单，就和我们访问网页一样，只是它的返回结果更单一(JsoN或xML)。它的优点在于实现简单，标准化和跨语言，比较适合对外提供openAPI的场景，而它的缺点是HTTP协议传输效率较低、短连接开销较大(HTTP2.0后有很大改进)。**而基于Tcp的RPc调用，由于TcP协议处于协议栈的下层，能够更加灵活地对协议字段进行定制，减少网络开销，提高性能，实现更大的吞吐量和并发数。但是需要更多地关注底层复杂的细节，跨语言和跨平台难度大，实现的代价更高，它比较适合内部系统之间追求极致性能的场景。**

![3670932192-5da80609a390f](https://raw.githubusercontent.com/eatherTan/PicGo/master/img/3670932192-5da80609a390f.png?token=AHCLHAN7KWZSC6PN6KLYY5C72C5LU)

1.调用方(client）通过本地的RPc代理(Proxy)调用相应的接口
2.本地代理将RPc的服务名，方法名和参数等等信息转换成一个标准的RPC Request对象交给RPc框架
3.RPC框架采用RPc协议(RPC Protocol)将RPC Request对象序列化成二进制形式，然后通过TCP通道传递给服务提供方(Server)
4.服务端（Server)收到二进制数据后，将它反序列化成RPC Request对象
5.服务端(Server）根据RPC Request 中的信息找到本地对应的方法，传入参数执行，得到结果，并将结果封装成RPC Response交给RPc框架
6.RPC框架通过RPc协议(RPC Protocol)将RPC Response对象序列化成二进制形式，然后通过TcP通道传递给服务调用方(client)
7.调用方(client)收到二进制数据后，将它反序列化成RPC Response对象，并且将结果通过本地代理(Proxy)返回给业务代码