多线程并发面试题 https://juejin.cn/post/6854573221258199048

### 1. 对象及变量的并发访问

### 1. volatile 关键字

1.volatile的特性

> volatile关键字保证了数据的可见性
> volatile关键字防止指令重排序

\### 指令重排序遵循的规则：

- Happens Before
- as-if-serial：不管怎么重排序（编译器和处理器为了提高并行度），（单线程）程序的执行结果不能被改变。

### 为什么synchronized无法禁止指令重排，却能保证有序性？

因为重排序需要遵循`as-if-serial：不管怎么重排序（编译器和处理器为了提高并行度），（单线程情况下）程序的执行结果不能被改变。`；

而`syncronized`锁就是保证多线程同时访问时一个资源时，只能有一个线程能拿到锁然后访问这个资源；所以就算是发生重排序，也是在单线程情况下发生的，对程序结果没有影响。

因此就算发生重排序，也可以保证有序性。

### 2.syncronized的实现原理

1. syncronized修饰代码块底层是使用了`monitorenter` `monitorexit` 指令来实现同步
2. syncronized修饰普通方法底层是使用了Flag标记`ACC_SYNCRONIZED`标志符来实现同步
3. monitorentermonitorexit`和`ACC_SYNCRONIZED`都是**「基于Monitor实现」**